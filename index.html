<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BLIZKO</title>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    :root{
      --bg:#ffffff;
      --text:#111111;
      --muted:#666;
      --card:#ffffff;
      --border:#eeeeee;
      --shadow: 0 10px 30px rgba(0,0,0,.08);
      --accent:#ff9a6a;
      --accent2:#ffb08a;
      --pill:#f6f6f6;
      --danger:#ff4d4d;
      --radius:18px;
    }

    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
    }

    .wrap{
      max-width: 520px;
      margin: 0 auto;
      padding: 16px;
      padding-bottom: 90px;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom: 14px;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      font-weight: 800;
      letter-spacing: .2px;
      font-size: 18px;
    }

    .dot{
      width:10px;height:10px;border-radius:999px;
      background: linear-gradient(135deg, var(--accent), #ff6f91);
      box-shadow: 0 6px 16px rgba(255,154,106,.45);
    }

    .me{
      font-size: 13px;
      color: var(--muted);
      text-align:right;
      line-height: 1.2;
      user-select:none;
    }

    .title{
      font-size: 22px;
      font-weight: 800;
      margin: 6px 0 10px;
    }

    .subtitle{
      color: var(--muted);
      margin: 0 0 14px;
      font-size: 14px;
    }

    .list{
      display:flex;
      flex-direction:column;
      gap: 12px;
      margin-top: 10px;
    }

    .chat{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 12px;
      box-shadow: var(--shadow);
      display:flex;
      gap: 12px;
      align-items: center;
    }

    .avatar{
      width: 54px; height: 54px;
      border-radius: 16px;
      background: linear-gradient(135deg, #ffe1d5, #ffd0ba);
      border: 1px solid var(--border);
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight: 800;
      color:#7a3a22;
      flex: 0 0 auto;
      position:relative;
      overflow:hidden;
    }
    .avatar img{ width:100%; height:100%; object-fit:cover; display:block; }

    .content{
      flex: 1 1 auto;
      min-width: 0;
    }

    .row1{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
    }

    .name{
      font-weight: 800;
      font-size: 16px;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
      max-width: 240px;
    }

    .pill{
      background: var(--pill);
      border: 1px solid var(--border);
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 12px;
      color: #333;
      white-space: nowrap;
      flex: 0 0 auto;
    }

    .row2{
      margin-top: 6px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
    }

    .preview{
      color: var(--muted);
      font-size: 13px;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
      max-width: 280px;
    }

    .btn{
      border: none;
      border-radius: 14px;
      padding: 10px 12px;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      color: white;
      box-shadow: 0 10px 22px rgba(255,154,106,.35);
      flex: 0 0 auto;
    }

    .btn:active{ transform: translateY(1px); }

    .empty{
      border: 1px dashed var(--border);
      border-radius: var(--radius);
      padding: 16px;
      color: var(--muted);
      background: #fafafa;
    }

    .empty b{ color: var(--text); }

    .footer{
      position: fixed;
      left:0; right:0; bottom:0;
      background: rgba(255,255,255,.92);
      backdrop-filter: blur(10px);
      border-top: 1px solid var(--border);
      padding: 12px 16px;
    }

    .footer .inner{
      max-width: 520px;
      margin:0 auto;
      display:flex;
      gap: 10px;
    }

    .ghost{
      flex:1;
      border: 1px solid var(--border);
      background: #fff;
      color: #111;
      border-radius: 14px;
      padding: 12px;
      font-weight: 800;
      cursor:pointer;
    }

    .accent{
      flex:1;
      border: none;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      color: #fff;
      border-radius: 14px;
      padding: 12px;
      font-weight: 800;
      cursor:pointer;
      box-shadow: 0 10px 22px rgba(255,154,106,.35);
    }

    .small{
      font-size: 12px;
      color: var(--muted);
      margin-top: 10px;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand"><span class="dot"></span> BLIZKO</div>
      <div class="me" id="me">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</div>
    </div>

    <div class="title">üí¨ –ú–æ–∏ —á–∞—Ç—ã</div>
    <div class="subtitle">–ó–¥–µ—Å—å —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∏. –ö–æ–≥–¥–∞ –≤—Ä–µ–º—è –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è ‚Äî —á–∞—Ç –∏—Å—á–µ–∑–Ω–µ—Ç.</div>

    <div id="list" class="list"></div>

    <div class="small" id="hint"></div>
  </div>

  <div class="footer">
    <div class="inner">
      <button class="ghost" id="btnRefresh">–û–±–Ω–æ–≤–∏—Ç—å</button>
      <button class="accent" id="btnInfo">–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç</button>
    </div>
  </div>

  <script>
    const tg = window.Telegram.WebApp;
    tg.ready();

    const user = tg.initDataUnsafe?.user;
    document.getElementById("me").textContent =
      user ? `–¢—ã: ${user.first_name} (id: ${user.id})` : "–û—Ç–∫—Ä–æ–π —á–µ—Ä–µ–∑ Telegram";

    // –ó–∞–≥–ª—É—à–∫–∏ —á–∞—Ç–æ–≤ (–ø–æ—Ç–æ–º –∑–∞–º–µ–Ω–∏–º –¥–∞–Ω–Ω—ã–º–∏ —Å —Å–µ—Ä–≤–µ—Ä–∞)
    const now = Date.now();
    let chats = [
      {
        chatId: "c1",
        name: "–ê–ª–∏—Å–∞",
        last: "–û–∫–µ–π, —Ç–æ–≥–¥–∞ —Å–µ–≥–æ–¥–Ω—è –±–µ–∑ —Å–ø–µ—à–∫–∏ üôÇ",
        expiresAt: now + 1000 * 60 * 60 * 21 + 1000 * 60 * 13, // ~21—á 13–º
        avatarText: "–ê"
      },
      {
        chatId: "c2",
        name: "–ö–∞—Ç—è",
        last: "–¢—ã –≤ –∫–∞–∫–æ–º —Ä–∞–π–æ–Ω–µ? –Ø —Ä—è–¥–æ–º.",
        expiresAt: now + 1000 * 60 * 60 * 2 + 1000 * 60 * 5, // ~2—á 5–º
        avatarText: "–ö"
      },
      {
        chatId: "c3",
        name: "–õ–∏–∑–∞",
        last: "–î–∞–≤–∞–π –∫–æ—Ä–æ—Ç–∫–æ: –∫–æ—Ñ–µ –∏–ª–∏ –ø—Ä–æ–≥—É–ª–∫–∞?",
        expiresAt: now + 1000 * 60 * 26, // ~26–º
        avatarText: "–õ"
      }
    ];

    function pad2(n){ return String(n).padStart(2, "0"); }

    function formatRemaining(ms){
      if(ms <= 0) return "–∏—Å—Ç—ë–∫";
      const totalMin = Math.ceil(ms / 60000);
      const h = Math.floor(totalMin / 60);
      const m = totalMin % 60;
      if(h <= 0) return `${m}–º`;
      return `${h}—á ${pad2(m)}–º`;
    }

    function render(){
      // —Ñ–∏–ª—å—Ç—Ä—É–µ–º –∏—Å—Ç—ë–∫—à–∏–µ
      const t = Date.now();
      chats = chats.filter(c => c.expiresAt > t);

      const list = document.getElementById("list");
      list.innerHTML = "";

      if(chats.length === 0){
        const empty = document.createElement("div");
        empty.className = "empty";
        empty.innerHTML = `<b>–ü–æ–∫–∞ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —á–∞—Ç–æ–≤.</b><br/>–ß–∞—Ç –ø–æ—è–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ –≤–∑–∞–∏–º–Ω–æ—Å—Ç–∏ –∏ –ø–µ—Ä–≤–æ–≥–æ –æ—Ç–≤–µ—Ç–∞.`;
        list.appendChild(empty);

        document.getElementById("hint").textContent =
          "–ü–æ–¥—Å–∫–∞–∑–∫–∞: –±–æ—Ç –Ω—É–∂–µ–Ω –¥–ª—è –∞–Ω–∫–µ—Ç –∏ –º—ç—Ç—á–µ–π, –∞ –æ–±—â–µ–Ω–∏–µ –±—É–¥–µ—Ç –∑–¥–µ—Å—å.";
        return;
      }

      document.getElementById("hint").textContent =
        "–ù–∞–∂–º–∏ ¬´–û—Ç–∫—Ä—ã—Ç—å¬ª, —á—Ç–æ–±—ã –ø–∏—Å–∞—Ç—å –≤ –≤—ã–±—Ä–∞–Ω–Ω—ã–π —á–∞—Ç. (–ü–æ–∫–∞ —ç—Ç–æ –¥–µ–º–æ-—ç–∫—Ä–∞–Ω.)";

      chats
        .sort((a,b) => a.expiresAt - b.expiresAt) // –∫—Ç–æ –±—ã—Å—Ç—Ä–µ–µ –∏—Å—Ç–µ—á—ë—Ç ‚Äî –≤—ã—à–µ
        .forEach(c => {
          const msLeft = c.expiresAt - Date.now();

          const el = document.createElement("div");
          el.className = "chat";
          el.innerHTML = `
            <div class="avatar" aria-hidden="true">${c.avatarText || "‚Ä¢"}</div>
            <div class="content">
              <div class="row1">
                <div class="name">${c.name}</div>
                <div class="pill">‚è≥ ${formatRemaining(msLeft)}</div>
              </div>
              <div class="row2">
                <div class="preview">${c.last || ""}</div>
                <button class="btn" data-open="${c.chatId}">–û—Ç–∫—Ä—ã—Ç—å</button>
              </div>
            </div>
          `;

          list.appendChild(el);
        });

      // –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ "–û—Ç–∫—Ä—ã—Ç—å"
      [...document.querySelectorAll('button[data-open]')].forEach(btn => {
        btn.onclick = () => {
          const id = btn.getAttribute("data-open");
          tg.showAlert(`–û—Ç–∫—Ä—ã–≤–∞–µ–º —á–∞—Ç ${id} (—Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥ ‚Äî —ç–∫—Ä–∞–Ω –ø–µ—Ä–µ–ø–∏—Å–∫–∏)`);
        };
      });
    }

    document.getElementById("btnRefresh").onclick = render;

    document.getElementById("btnInfo").onclick = () => {
      tg.showAlert("–ß–∞—Ç—ã –∂–∏–≤—É—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è. –ö–æ–Ω—Ç–∞–∫—Ç—ã –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º. –û–±—â–µ–Ω–∏–µ ‚Äî –≤–Ω—É—Ç—Ä–∏ BLIZKO Mini App.");
    };

    render();
    setInterval(render, 30000); // –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–π–º–µ—Ä—ã —Ä–∞–∑ –≤ 30 —Å–µ–∫—É–Ω–¥
  </script>
</body>
</html>
